{% extends "base.html" %}
{% block title %}Requests{% endblock %}
{% from "includes/_form_helper.html" import render_field %}
{% block content %}
<style>
  .collapsible {
    background-color: #777;
    color: white;
    cursor: pointer;
    padding: 18px;
    width: 100%;
    border: none;
    text-align: left;
    outline: none;
    font-size: 15px;
  }

  .active, .collapsible:hover {
    background-color: #555;
  }

  .filter {
    padding: 0 18px;
    display: none;
    overflow: hidden;
    background-color: #f1f1f1;
  }
</style>
<div class="container-fluid content">
  <div class="justify-content-center">
    <h4 class="text-center">Requests</h4>
  </div>

  <button type="button" class="collapsible">Filter</button>
  <div class="filter">
    <form class="form" method="POST">
      {{ form.csrf_token }}
      <br>
      <div class="form-group">
        {{ render_field(form.query, class="form-control") }}
      </div>
      <div class="row">
        <div class="form-group col-sm-6">
          {{ render_field(form.alert_level, class="form-control") }}
        </div>
        <div class="form-group col-sm-6">
          {{ render_field(form.date, class="form-control", placeholder="YYYY-MM-DD") }}
        </div>
      </div>
      <div class="row">
        <span class="col-sm-10"></span>
        <button type="submit" class="btn btn-primary col-sm-2">Submit</button>
      </div>

    </form>

  </div>

  <div class="row justify-content-center">
    <div class="col-sm-12">
      <table class="table table-striped table-hover">
        <colgroup>
          <col style="width: 10%;" />
          <col style="width: 10%;" />
          <col style="width: 10%;" />
          <col style="width: 10%;" />
          <col style="width: 10%;" />
          <col style="width: 10%;" />
          <col style="width: 10%;" />
          <col style="width: 30%;" />
        </colgroup>
        <thead>
          <tr>
            <th scope="col">Request ID</th>
            <th scope="col">Alert Level</th>
            <th scope="col">Datetime</th>
            <th scope="col">IP Address</th>
            <th scope="col">Request Parameters</th>
            <th scope="col">Status</th>
            <th scope="col">Message</th>
            <th scope="col">Response</th>
          </tr>
        </thead>
        <tbody>
          {% for row in alerts %}
          {% if row.alert_level == "High" %}
          <tr class="table-danger">
            {% elif row.alert_level == "Medium" %}
          <tr class="table-warning">
            {% else %}
          <tr class="table-success">
            {% endif %}
            <td>{{ row.request.id }}</td>
            <td>{{ row.alert_level }}</td>
            <td>{{ row.request.datetime }}</td>
            <td>{{ row.request.ip_address }}</td>
            <td>{{ row.request.request_params }}</td>
            <td>{{ row.request.status }}</td>
            <td>{{ row.request.status_msg }}</td>
            <td>
              <textarea
                class="request-response border-0 bg-transparent form-control"
                disabled="disabled">{{ row.request.response }}</textarea>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  var coll = document.getElementsByClassName("collapsible");
  var x;

  for (x = 0; x < coll.length; x++) {
    coll[x].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.display === "block") {
        content.style.display = "none";
      } else {
        content.style.display = "block";
      }
    });
}
</script>
{% endblock %}
